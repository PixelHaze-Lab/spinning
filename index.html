<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ‡ãƒ¢ï¼ˆå½“ãŸã‚Šãƒã‚ºãƒ¬ä»˜ãï¼‰</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 0;
      background: #f3f4f6;
    }

    .roulette-wrapper {
      position: relative;
      width: 260px;
      height: 260px;
    }

    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 6px solid #111827;
      box-sizing: border-box;
      background: conic-gradient(
        #f97373 0deg 60deg,
        #fb923c 60deg 120deg,
        #facc15 120deg 180deg,
        #34d399 180deg 240deg,
        #60a5fa 240deg 300deg,
        #a78bfa 300deg 360deg
      );
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      transform: rotate(0deg);
    }

    .center-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #111827;
      color: #f9fafb;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 14px;
    }

    .pointer {
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 16px solid transparent;
      border-right: 16px solid transparent;
      border-bottom: 24px solid #ef4444;
      filter: drop-shadow(0 3px 4px rgba(0, 0, 0, 0.3));
    }

    button {
      padding: 10px 26px;
      border-radius: 999px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(to right, #6366f1, #ec4899);
      color: #f9fafb;
      box-shadow: 0 8px 16px rgba(79, 70, 229, 0.4);
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }

    button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 4px 8px rgba(79, 70, 229, 0.5);
      filter: brightness(0.96);
    }

    #result {
      font-size: 18px;
      font-weight: 500;
      color: #111827;
      min-height: 1.5em;
      transition: color 0.2s ease, transform 0.2s ease;
    }

    .segments-info {
      font-size: 13px;
      color: #4b5563;
    }

    /* å½“ãŸã‚Šæ¼”å‡º */
    #result.win {
      color: #16a34a; /* ç·‘ */
      animation: pop 0.5s ease;
    }

    /* ãƒã‚ºãƒ¬æ¼”å‡º */
    #result.lose {
      color: #dc2626; /* èµ¤ */
      animation: shake 0.4s ease;
    }

    @keyframes pop {
      0%   { transform: scale(0.8); }
      50%  { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25%      { transform: translateX(-4px); }
      75%      { transform: translateX(4px); }
    }
  </style>
</head>
<body>
  <div class="roulette-wrapper">
    <div class="pointer"></div>
    <div class="wheel" id="wheel">
      <div class="center-circle">ROULETTE</div>
    </div>
  </div>

  <button id="spinButton">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  <div id="result">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆé–‹å§‹ï¼</div>
  <div class="segments-info">
    ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ: A / B / C / D / E / F<br>
    ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã§ã¯ Aãƒ»C ãŒã€Œå½“ãŸã‚Šã€ï¼‰
  </div>

  <script>
    // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã®é …ç›®
    const items = ["A", "B", "C", "D", "E", "F"];

    // ã€Œå½“ãŸã‚Šã€ã«ã—ãŸã„é …ç›®
    const winners = ["A", "C"];  // â†ã“ã“ã‚’æ›¸ãæ›ãˆã‚Œã°OK

    const wheel = document.getElementById("wheel");
    const spinButton = document.getElementById("spinButton");
    const result = document.getElementById("result");

    let isSpinning = false;
    let baseRotation = 0;         // ç¾åœ¨ã®è§’åº¦
    let spinAnimationId = null;   // requestAnimationFrame ã®ID

    const segmentCount = items.length;
    const segmentAngle = 360 / segmentCount;

    // ãã‚‹ãã‚‹å›ã£ã¦ã‚‹é–“ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    function continuousSpin() {
      baseRotation = (baseRotation + 10) % 360; // 1ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«10åº¦å›ã™
      wheel.style.transform = `rotate(${baseRotation}deg)`;
      spinAnimationId = requestAnimationFrame(continuousSpin);
    }

    function easeOutQuad(t) {
      return t * (2 - t);
    }

    spinButton.addEventListener("click", () => {
      // ã¾ãšæ¯å›ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
      result.classList.remove("win", "lose");

      if (!isSpinning) {
        // â–¼ ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆ1å›ç›®ï¼‰
        isSpinning = true;
        spinButton.textContent = "ã‚¹ãƒˆãƒƒãƒ—";
        result.textContent = "ãã‚‹ãã‚‹å›è»¢ä¸­â€¦";
        continuousSpin();
      } else {
        // â–¼ ã‚¹ãƒˆãƒƒãƒ—ï¼ˆ2å›ç›®ï¼‰â†’ çµæœæ±ºå®š
        isSpinning = false;
        spinButton.textContent = "ã‚‚ã†ä¸€åº¦";
        cancelAnimationFrame(spinAnimationId);

        // ãƒ©ãƒ³ãƒ€ãƒ ã§ã©ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«ã™ã‚‹ã‹æ±ºå®š
        const randomIndex = Math.floor(Math.random() * segmentCount);

        // ä½•å‘¨ã‹ã—ã¦ã‹ã‚‰ãã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã§æ­¢ã¾ã‚‹ã‚ˆã†ã«è§’åº¦ã‚’è¨ˆç®—
        const extraSpins = 5; // ä½•å‘¨ã•ã›ã‚‹ã‹ï¼ˆè¦‹ãŸç›®ç”¨ï¼‰
        const targetAngleFromTop = randomIndex * segmentAngle + segmentAngle / 2;
        const targetRotation =
          extraSpins * 360 + targetAngleFromTop;

        const startRotation = baseRotation;
        const diff = targetRotation - startRotation;
        const duration = 1200; // ãƒŸãƒªç§’ï¼ˆæ­¢ã¾ã‚‹ã¨ãã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ï¼‰

        const startTime = performance.now();

        function animateToResult(now) {
          const elapsed = now - startTime;
          const t = Math.min(elapsed / duration, 1);
          const eased = easeOutQuad(t);
          const currentAngle = startRotation + diff * eased;

          wheel.style.transform = `rotate(${currentAngle}deg)`;

          if (t < 1) {
            requestAnimationFrame(animateToResult);
          } else {
            // æœ€çµ‚è§’åº¦ã‚’ä¿å­˜
            baseRotation = currentAngle % 360;

            // ä¸Šï¼ˆãƒã‚¤ãƒ³ã‚¿ä½ç½®ï¼‰ã‹ã‚‰è¦‹ã¦ã©ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«ã„ã‚‹ã‹è¨ˆç®—
            const normalized =
              (360 - baseRotation + 360) % 360; // 0åº¦ãŒä¸Šã«ãªã‚‹ã‚ˆã†ã«è£œæ­£
            const index = Math.floor(normalized / segmentAngle) % segmentCount;

            const hit = items[index];
            const isWin = winners.includes(hit);

            if (isWin) {
              result.textContent = `ğŸ‰ å½“ãŸã‚Šï¼ã€Œ${hit}ã€ãŒå‡ºã¾ã—ãŸï¼`;
              result.classList.add("win");
            } else {
              result.textContent = `æ®‹å¿µâ€¦ã€Œ${hit}ã€ã§ã—ãŸã€‚ã‚‚ã†ä¸€å›ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼Ÿ`;
              result.classList.add("lose");
            }
          }
        }

        requestAnimationFrame(animateToResult);
      }
    });
  </script>
</body>
</html>
